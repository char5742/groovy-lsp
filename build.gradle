plugins {
    id 'com.github.ben-manes.versions' version '0.51.0' apply false
    id 'com.github.johnrengelman.shadow' version '8.1.1' apply false
}

allprojects {
    group = 'com.groovy.lsp'
    version = '0.1.0-SNAPSHOT'
    
    repositories {
        mavenCentral()
        gradlePluginPortal()
        maven {
            url 'https://repo.gradle.org/gradle/libs-releases/'
        }
        maven {
            url 'https://groovy.jfrog.io/artifactory/libs-release-local'
        }
        maven {
            url 'https://repo.eclipse.org/releases/latest'
        }
    }
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'groovy'
    
    java {
        toolchain {
            languageVersion = JavaLanguageVersion.of(23)
        }
        // Temporarily disable module path to fix build issues
        modularity.inferModulePath = false
    }
    
    dependencies {
        implementation 'org.apache.groovy:groovy:4.0.27'
        implementation 'org.apache.groovy:groovy-json:4.0.27'
        implementation 'org.apache.groovy:groovy-xml:4.0.27'
        implementation 'org.apache.groovy:groovy-nio:4.0.27'
        implementation 'org.apache.groovy:groovy-templates:4.0.27'
        implementation 'org.slf4j:slf4j-api:2.0.16'
        implementation 'ch.qos.logback:logback-classic:1.5.16'
        
        testImplementation 'org.junit.jupiter:junit-jupiter:5.11.4'
        testImplementation 'org.junit.jupiter:junit-jupiter-params:5.11.4'
        testImplementation 'io.mockk:mockk:1.13.14'
        testImplementation 'org.assertj:assertj-core:3.27.3'
        testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
    }
    
    test {
        useJUnitPlatform()
    }
    
    tasks.withType(JavaCompile) {
        options.encoding = 'UTF-8'
        options.compilerArgs += ['-parameters']
    }
    
    tasks.withType(GroovyCompile) {
        options.encoding = 'UTF-8'
        groovyOptions.parameters = true
    }
    
    configurations.all {
        resolutionStrategy {
            capabilitiesResolution {
                withCapability('org.codehaus.groovy:groovy') {
                    selectHighestVersion()
                }
                withCapability('org.codehaus.groovy:groovy-json') {
                    selectHighestVersion()
                }
                withCapability('org.codehaus.groovy:groovy-xml') {
                    selectHighestVersion()
                }
                withCapability('org.codehaus.groovy:groovy-templates') {
                    selectHighestVersion()
                }
            }
            force 'org.apache.groovy:groovy:4.0.27'
            force 'org.apache.groovy:groovy-json:4.0.27'
            force 'org.apache.groovy:groovy-xml:4.0.27'
            force 'org.apache.groovy:groovy-nio:4.0.27'
            force 'org.apache.groovy:groovy-templates:4.0.27'
        }
    }
}